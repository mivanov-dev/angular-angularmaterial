<div fxLayoutAlign="center center"
     class="container"
     fxLayout="column"
     fxLayoutGap="10px">

    <ng-template #alertContainer></ng-template>

    <div>
        <mat-card fxFlex="350px"
                  fxFlex.xs="300px"
                  class="mat-elevation-z4">
            <mat-card-header fxLayout="row"
                             fxLayoutAlign="center center">
                <mat-card-title>2FA</mat-card-title>
            </mat-card-header>

            <mat-card-content fxLayout="column"
                              fxLayoutGap="10px"
                              fxLayoutAlign="space-between none">

                <mat-list>
                    <mat-list-item>
                        <h3 mat-line
                            class="mat-title mat-h3">QR Code</h3>
                        <div mat-line>
                            <div fxLayout="row"
                                 fxLayoutGap="10px"
                                 fxLayoutAlign="space-between center">
                                <mat-icon>qr_code_2</mat-icon>
                                <p>Authenticator</p>
                            </div>
                            <div fxLayout="row"
                                 fxLayoutAlign="end center"
                                 fxFlex>
                                <mat-checkbox [ngModel]="user?.is2FAenabled"
                                              (change)="setupQr($event.checked)"
                                              color="primary"></mat-checkbox>
                            </div>
                        </div>
                    </mat-list-item>

                    <mat-list-item *ngIf="user && setup">
                        <span mat-line
                              fxLayoutAlign="center center">
                            Scan the QR code with Authenticator
                        </span>
                        <div mat-line
                             fxLayoutAlign="center center">
                            <img [src]="image"
                                 loading="lazy" />
                        </div>
                        <span mat-line
                              fxLayoutAlign="center center">
                            or enter Secret Key
                        </span>
                        <span mat-line
                              #secretKey
                              fxLayoutAlign="center center">
                            {{ setup?.secretKey }}
                        </span>
                    </mat-list-item>

                    <mat-divider [inset]="true"></mat-divider>
                </mat-list>

                <form [formGroup]="form"
                      #formDirective="ngForm"
                      (ngSubmit)="onSubmit()"
                      *ngIf="user && setup">
                    <mat-form-field class="field"
                                    fxLayout="column"
                                    appearance="outline">
                        <mat-label>One-Time-Code</mat-label>
                        <input matInput
                               type="text"
                               formControlName="code"
                               required>
                        <mat-error *ngIf="hasCodeControlErrorRequired(codeControl)">
                            Code is <strong>required</strong> !
                        </mat-error>
                    </mat-form-field>
                    <div fxLayout="column">
                        <button mat-raised-button
                                color="primary"
                                fxLayout="column"
                                fxLayoutAlign="center stretch"
                                type="submit"
                                [disabled]="isLoading">
                            Verify
                        </button>
                    </div>
                </form>

            </mat-card-content>
        </mat-card>

    </div>
</div>